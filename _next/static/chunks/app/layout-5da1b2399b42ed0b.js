(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4922:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9324,23)),Promise.resolve().then(s.bind(s,8249)),Promise.resolve().then(s.bind(s,4010)),Promise.resolve().then(s.bind(s,7113)),Promise.resolve().then(s.t.bind(s,5688,23)),Promise.resolve().then(s.t.bind(s,7051,23))},8249:(e,t,s)=>{"use strict";s.d(t,{ChatContextProvider:()=>S,v:()=>p});var a=s(5155),r=s(2115),n=s(9788),o=s(490),l=s(1824);class i extends l.cf{constructor(){super("ChatHistoryDatabase"),this.version(1).stores({messages:"++id, roomId, timestamp"})}}let c=new i,m=async(e,t)=>{e.isSystemMessage||await c.messages.add({...e,roomId:t})},u=async e=>await c.messages.where("roomId").equals(e).sortBy("timestamp"),d="Guest",h=(()=>{let e=sessionStorage.getItem("teleparty_tab_id");return e||(e=(0,o.Ak)(),sessionStorage.setItem("teleparty_tab_id",e)),e})(),v=e=>"teleparty_".concat(e,"_").concat(h),y=v("chat_room_id"),f=v("user_nickname"),b=v("user_icon"),g=(0,r.createContext)(void 0),S=e=>{let{children:t}=e,[s,o]=(0,r.useState)(null),[l,i]=(0,r.useState)(()=>localStorage.getItem(y)),[c,h]=(0,r.useState)(()=>({nickname:localStorage.getItem(f)||d,userIcon:localStorage.getItem(b)||void 0})),[v,S]=(0,r.useState)([]),[p,k]=(0,r.useState)(!1),[w,I]=(0,r.useState)(!!l),[C,E]=(0,r.useState)([]),[_,T]=(0,r.useState)([]),[P,x]=(0,r.useState)(!1),N=(0,r.useRef)(l);(0,r.useEffect)(()=>{N.current=l},[l]);let L=(0,r.useRef)(c);(0,r.useEffect)(()=>{L.current=c},[c]);let M=(0,r.useCallback)((e,t)=>{let s={isSystemMessage:!0,body:e,permId:"system",timestamp:Date.now(),...t&&{userNickname:t.nickname,userIcon:t.userIcon}};S(e=>[...e,s])},[]),A=(0,r.useCallback)(e=>{switch(e.type){case"userId":let t=e.data.userId;h(e=>e?{...e,socketId:t}:{nickname:d,socketId:t});break;case n.mw.SEND_MESSAGE:N.current&&m(e.data,N.current),S(t=>[...t,e.data]);break;case n.mw.SET_TYPING_PRESENCE:h(t=>(T(e.data.usersTyping.filter(e=>e!==(null==t?void 0:t.socketId))||[]),t));break;case"userList":E(e.data.map(e=>({nickname:e.userSettings.userNickname||d,userIcon:e.userSettings.userIcon,socketId:e.socketConnectionId})))}},[N]),G=(0,r.useCallback)(()=>{let e=new n.Ul({onConnectionReady:async()=>{var t;if(k(!0),N.current&&(null===(t=L.current)||void 0===t?void 0:t.nickname))try{await e.joinChatRoom(L.current.nickname,N.current,L.current.userIcon)}catch(e){console.error("Failed to rejoin chat room:",e),i(null),localStorage.removeItem(y)}I(!1)},onClose:()=>{k(!1),E([]),T([]),o(t=>t===e?null:t)},onMessage:A});o(e)},[A]),D=(0,r.useCallback)(()=>{s&&s.teardown(),l&&I(!0),o(null),x(!1)},[s,l]);return(0,r.useEffect)(()=>{if(!s&&!P){let e=setTimeout(G,1e3);return()=>clearTimeout(e)}},[s,P,G]),(0,r.useEffect)(()=>{let e=()=>{"visible"!==document.visibilityState||p||D()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[p,D]),(0,r.useEffect)(()=>{l?(localStorage.setItem(y,l),(async()=>{S(await u(l))})()):(localStorage.removeItem(y),S([]))},[l]),(0,r.useEffect)(()=>{(null==c?void 0:c.nickname)&&localStorage.setItem(f,c.nickname),(null==c?void 0:c.userIcon)?localStorage.setItem(b,c.userIcon):localStorage.removeItem(b)},[c]),(0,a.jsx)(g.Provider,{value:{client:s,isConnected:p,isReconnecting:w,chatRoomId:l,setChatRoomId:i,currentUser:c,setCurrentUser:h,users:C,usersTyping:_,messages:v,setMessages:S,addSystemMessage:M,reconnect:D,disconnect:()=>{x(!0),s&&(s.teardown(),o(null)),k(!1),E([]),T([]),i(null),localStorage.removeItem(y),M("Disconnected from chat service")}},children:t})},p=()=>{let e=(0,r.useContext)(g);if(void 0===e)throw Error("useChatContext must be used within a ChatContextProvider");return e}},4010:(e,t,s)=>{"use strict";s.d(t,{Toaster:()=>o});var a=s(5155),r=s(7113),n=s(814);let o=e=>{let{...t}=e,{theme:s="system"}=(0,r.D)();return(0,a.jsx)(n.l$,{theme:s,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})}},9324:()=>{},5688:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_6ddc71",variable:"__variable_6ddc71"}},7051:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_b08e71",variable:"__variable_b08e71"}},7113:(e,t,s)=>{"use strict";s.d(t,{D:()=>m,ThemeProvider:()=>u});var a=s(2115),r=(e,t,s,a,r,n,o,l)=>{let i=document.documentElement,c=["light","dark"];function m(t){(Array.isArray(e)?e:[e]).forEach(e=>{let s="class"===e,a=s&&n?r.map(e=>n[e]||e):r;s?(i.classList.remove(...a),i.classList.add(n&&n[t]?n[t]:t)):i.setAttribute(e,t)}),l&&c.includes(t)&&(i.style.colorScheme=t)}if(a)m(a);else try{let e=localStorage.getItem(t)||s,a=o&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;m(a)}catch(e){}},n=["light","dark"],o="(prefers-color-scheme: dark)",l="undefined"==typeof window,i=a.createContext(void 0),c={setTheme:e=>{},themes:[]},m=()=>{var e;return null!=(e=a.useContext(i))?e:c},u=e=>a.useContext(i)?a.createElement(a.Fragment,null,e.children):a.createElement(h,{...e}),d=["light","dark"],h=e=>{let{forcedTheme:t,disableTransitionOnChange:s=!1,enableSystem:r=!0,enableColorScheme:l=!0,storageKey:c="theme",themes:m=d,defaultTheme:u=r?"system":"light",attribute:h="data-theme",value:g,children:S,nonce:p,scriptProps:k}=e,[w,I]=a.useState(()=>y(c,u)),[C,E]=a.useState(()=>"system"===w?b():w),_=g?Object.values(g):m,T=a.useCallback(e=>{let t=e;if(!t)return;"system"===e&&r&&(t=b());let a=g?g[t]:t,o=s?f(p):null,i=document.documentElement,c=e=>{"class"===e?(i.classList.remove(..._),a&&i.classList.add(a)):e.startsWith("data-")&&(a?i.setAttribute(e,a):i.removeAttribute(e))};if(Array.isArray(h)?h.forEach(c):c(h),l){let e=n.includes(u)?u:null,s=n.includes(t)?t:e;i.style.colorScheme=s}null==o||o()},[p]),P=a.useCallback(e=>{let t="function"==typeof e?e(w):e;I(t);try{localStorage.setItem(c,t)}catch(e){}},[w]),x=a.useCallback(e=>{E(b(e)),"system"===w&&r&&!t&&T("system")},[w,t]);a.useEffect(()=>{let e=window.matchMedia(o);return e.addListener(x),x(e),()=>e.removeListener(x)},[x]),a.useEffect(()=>{let e=e=>{e.key===c&&(e.newValue?I(e.newValue):P(u))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[P]),a.useEffect(()=>{T(null!=t?t:w)},[t,w]);let N=a.useMemo(()=>({theme:w,setTheme:P,forcedTheme:t,resolvedTheme:"system"===w?C:w,themes:r?[...m,"system"]:m,systemTheme:r?C:void 0}),[w,P,t,C,r,m]);return a.createElement(i.Provider,{value:N},a.createElement(v,{forcedTheme:t,storageKey:c,attribute:h,enableSystem:r,enableColorScheme:l,defaultTheme:u,value:g,themes:m,nonce:p,scriptProps:k}),S)},v=a.memo(e=>{let{forcedTheme:t,storageKey:s,attribute:n,enableSystem:o,enableColorScheme:l,defaultTheme:i,value:c,themes:m,nonce:u,scriptProps:d}=e,h=JSON.stringify([n,s,i,t,m,c,o,l]).slice(1,-1);return a.createElement("script",{...d,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:"(".concat(r.toString(),")(").concat(h,")")}})}),y=(e,t)=>{let s;if(!l){try{s=localStorage.getItem(e)||void 0}catch(e){}return s||t}},f=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},b=e=>(e||(e=window.matchMedia(o)),e.matches?"dark":"light")}},e=>{var t=t=>e(e.s=t);e.O(0,[261,949,441,517,358],()=>t(4922)),_N_E=e.O()}]);