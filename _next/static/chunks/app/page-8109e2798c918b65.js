(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9589:(e,t,s)=>{Promise.resolve().then(s.bind(s,4208))},4208:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eL});var r=s(5155),a=s(2115),n=s(9271),o=s(4505),i=s(2823),l=s(814),c=s(8249),d=s(2317),u=s(1027),m=s(3463),x=s(9795);function g(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,x.QP)((0,m.$)(t))}let h=(0,u.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),f=a.forwardRef((e,t)=>{let{className:s,variant:a,size:n,asChild:o=!1,...i}=e,l=o?d.DX:"button";return(0,r.jsx)(l,{className:g(h({variant:a,size:n,className:s})),ref:t,...i})});function p(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:g("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function b(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:g("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function v(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:g("leading-none font-semibold",t),...s})}function j(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:g("px-6",t),...s})}function N(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:g("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}f.displayName="Button";var y=s(6195);function w(e){let{className:t,...s}=e;return(0,r.jsx)(y.b,{"data-slot":"label",className:g("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var k=s(2341);function C(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(k.bL,{"data-slot":"scroll-area",className:g("relative",t),...a,children:[(0,r.jsx)(k.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,r.jsx)(I,{}),(0,r.jsx)(k.OK,{})]})}function I(e){let{className:t,orientation:s="vertical",...a}=e;return(0,r.jsx)(k.VM,{"data-slot":"scroll-area-scrollbar",orientation:s,className:g("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",t),...a,children:(0,r.jsx)(k.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var S=s(6156);function R(e){let{className:t,...s}=e;return(0,r.jsx)(S.bL,{"data-slot":"tabs",className:g("flex flex-col gap-2",t),...s})}function A(e){let{className:t,...s}=e;return(0,r.jsx)(S.B8,{"data-slot":"tabs-list",className:g("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function E(e){let{className:t,...s}=e;return(0,r.jsx)(S.l9,{"data-slot":"tabs-trigger",className:g("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function L(e){let{className:t,...s}=e;return(0,r.jsx)(S.UC,{"data-slot":"tabs-content",className:g("flex-1 outline-none",t),...s})}function _(){let{client:e,isConnected:t,setChatRoomId:s,setCurrentUser:d,reconnect:u}=(0,c.v)(),[m,x]=(0,a.useState)(""),[g,h]=(0,a.useState)(""),[y,k]=(0,a.useState)(""),[I,S]=(0,a.useState)(!1),[_,z]=(0,a.useState)(!1),T=async e=>{if(e.length<50)return e;try{let t=await fetch("/api/shorten-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!t.ok)throw Error("Failed to shorten URL");let s=await t.json();return l.oR.success("Avatar URL shortened successfully!"),s.shortUrl}catch(t){return l.oR.error("Failed to shorten avatar URL",{description:"The original URL will be used instead."}),e}},D=async()=>{if(!e||!m.trim()){l.oR.error("Please enter a nickname",{description:"A nickname is required to create a chat room"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{S(!0);let t=g?await T(g):"",r=await e.createChatRoom(m.trim(),t);d(e=>({...e,nickname:m.trim(),userIcon:t||void 0})),s(r),l.oR.success("Chat room created!",{description:"Room ID: ".concat(r),duration:5e3})}catch(e){console.error("Failed to create room:",e),l.oR.error("Failed to create chat room",{description:"Please try again"})}finally{S(!1)}},P=async()=>{if(!e||!m.trim()||!y.trim()){l.oR.error("Missing information",{description:"Please enter both nickname and room ID"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{z(!0);let t=g?await T(g):"";await e.joinChatRoom(m.trim(),y.trim(),t),d(e=>({...e,nickname:m.trim(),userIcon:t||void 0})),s(y.trim()),l.oR.success("Joined chat room!",{description:"Welcome to room: ".concat(y.trim()),duration:3e3})}catch(e){l.oR.error("Failed to join chat room",{description:"Please check the room ID and try again"})}finally{z(!1)}},M=t?{text:"Connected",color:"text-chart-2"}:{text:"Connecting...",color:"text-chart-1"};return(0,r.jsx)(C,{children:(0,r.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,r.jsxs)("div",{className:"container mx-auto max-w-md pt-20",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)(n.A,{className:"mx-auto h-16 w-16 text-primary mb-4"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Teleparty Chat"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Connect with friends in real-time"})]}),(0,r.jsxs)(p,{className:"bg-card border-border",children:[(0,r.jsx)(b,{children:(0,r.jsx)(v,{className:"text-center text-card-foreground",children:"Get Started"})}),(0,r.jsx)(j,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(w,{htmlFor:"nickname",className:"text-card-foreground",children:"Nickname"}),(0,r.jsx)(N,{id:"nickname",placeholder:"Enter your nickname",value:m,onChange:e=>x(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(w,{htmlFor:"userIcon",className:"text-card-foreground",children:"Profile Image URL (optional)"}),(0,r.jsx)(N,{id:"userIcon",placeholder:"https://example.com/avatar.jpg",value:g,onChange:e=>h(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 py-2",children:[(0,r.jsx)("div",{className:"flex-1 border-t border-border"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"next"}),(0,r.jsx)("div",{className:"flex-1 border-t border-border"})]}),(0,r.jsxs)(R,{defaultValue:"create",className:"w-full",children:[(0,r.jsxs)(A,{className:"grid w-full grid-cols-2 bg-muted",children:[(0,r.jsx)(E,{value:"create",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Create Room"}),(0,r.jsx)(E,{value:"join",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Join Room"})]}),(0,r.jsx)(L,{value:"create",className:"space-y-4",children:(0,r.jsx)(f,{onClick:D,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!m.trim()||I,children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"mr-2 h-4 w-4"}),"Create Chat Room"]})})}),(0,r.jsxs)(L,{value:"join",className:"space-y-4 pt-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(w,{htmlFor:"roomId",className:"text-card-foreground",children:"Room ID"}),(0,r.jsx)(N,{id:"roomId",placeholder:"Enter room ID",value:y,onChange:e=>k(e.target.value),className:"mt-1 bg-background border-border text-foreground placeholder:text-muted-foreground"})]}),(0,r.jsx)(f,{onClick:P,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!m.trim()||!y.trim()||_,children:_?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Joining..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),"Join Chat Room"]})})]})]}),(0,r.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Status:"," ",(0,r.jsx)("span",{className:"font-medium ".concat(M.color),children:M.text}),!t&&(0,r.jsx)(f,{variant:"link",size:"sm",onClick:u,className:"text-primary hover:text-primary/80 ml-2",children:"Reconnect"})]})]})})]})]})})})}var z=s(9788),T=s(53),D=s(8134),P=s(3512),M=s(7386),U=s(878),F=s(9201),O=s(9828),G=s(1024),J=s(8701),H=s(9021),V=s(8283),B=s(4113),Y=s(4908),Z=s(767);function q(e){let{...t}=e;return(0,r.jsx)(Y.bL,{"data-slot":"dialog",...t})}function $(e){let{...t}=e;return(0,r.jsx)(Y.l9,{"data-slot":"dialog-trigger",...t})}function K(e){let{...t}=e;return(0,r.jsx)(Y.ZL,{"data-slot":"dialog-portal",...t})}function W(e){let{className:t,...s}=e;return(0,r.jsx)(Y.hJ,{"data-slot":"dialog-overlay",className:g("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function X(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(K,{"data-slot":"dialog-portal",children:[(0,r.jsx)(W,{}),(0,r.jsxs)(Y.UC,{"data-slot":"dialog-content",className:g("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[s,(0,r.jsxs)(Y.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(Z.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function Q(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:g("flex flex-col gap-2 text-center sm:text-left",t),...s})}function ee(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:g("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function et(e){let{className:t,...s}=e;return(0,r.jsx)(Y.hE,{"data-slot":"dialog-title",className:g("text-lg leading-none font-semibold",t),...s})}function es(e){let{className:t,...s}=e;return(0,r.jsx)(Y.VY,{"data-slot":"dialog-description",className:g("text-muted-foreground text-sm",t),...s})}function er(e){let{onAddLink:t,isActive:s}=e,[n,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)("");return(0,r.jsxs)(q,{open:n,onOpenChange:o,children:[(0,r.jsx)($,{asChild:!0,children:(0,r.jsx)(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 ".concat(s?"bg-accent":""),children:(0,r.jsx)(B.A,{className:"h-4 w-4"})})}),(0,r.jsx)(X,{className:"sm:max-w-md border-border",children:(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim())return;let s=i.trim();s.match(/^https?:\/\//)||(s="https://".concat(s)),t(s),l(""),o(!1)},children:[(0,r.jsxs)(Q,{children:[(0,r.jsx)(et,{children:"Add Link"}),(0,r.jsx)(es,{children:"Enter the URL you want to link to. HTTPS will be added automatically if not present."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(w,{htmlFor:"url",children:"URL"}),(0,r.jsx)(N,{id:"url",placeholder:"https://example.com",value:i,onChange:e=>l(e.target.value),autoFocus:!0})]})}),(0,r.jsxs)(ee,{children:[(0,r.jsx)(f,{type:"button",variant:"outline",onClick:()=>{l(""),o(!1)},children:"Cancel"}),(0,r.jsx)(f,{type:"submit",disabled:!i.trim(),children:"Add Link"})]})]})})]})}function ea(e){let{onTypingStart:t,onTypingStop:s,readonly:n=!1,content:o,fallbackText:i,className:d}=e,{client:u,isConnected:x}=(0,c.v)(),[g,h]=a.useState(!1),p=(0,P.hG)({immediatelyRender:!1,extensions:[M.A.configure({code:{HTMLAttributes:{class:"text-green-500 bg-green-500/10 p-1 rounded-md"}},paragraph:{HTMLAttributes:{class:n?"text-card-foreground":"text-foreground"}},bulletList:{HTMLAttributes:{class:"list-disc pl-6 my-2"}},orderedList:{HTMLAttributes:{class:"list-decimal pl-6 my-2"}},listItem:{HTMLAttributes:{class:"my-1"}}}),T.Ay.configure({openOnClick:n,HTMLAttributes:{class:n?"text-primary underline hover:text-primary/80":"text-blue-500 underline",target:"_blank",rel:"noopener noreferrer"}}),...n?[]:[D.A.configure({placeholder:"Send a message",emptyEditorClass:"text-muted-foreground"})]],content:n?o:"",editable:!n,editorProps:{attributes:{class:n?"prose prose-sm max-w-none text-card-foreground rich-message-content ".concat(d||""):"prose prose-sm max-w-none focus:outline-none text-foreground placeholder:text-muted-foreground min-h-[40px] max-h-[120px] overflow-y-auto p-3"},handleKeyDown:n?void 0:(e,t)=>"Enter"===t.key&&(t.preventDefault(),b(),!0)},onUpdate:n?void 0:e=>{let{editor:r}=e,a=r.getText().trim();h(!!a),a?null==t||t():null==s||s()}}),b=()=>{if(u&&p&&!n){if(!x){l.oR.error("Connection lost",{description:"Unable to send message. Please wait for reconnection."});return}if(p.getText().trim())try{let e=JSON.stringify(p.getJSON());u.sendMessage(z.mw.SEND_MESSAGE,{body:e}),p.commands.clearContent(),null==s||s()}catch(e){console.error("Failed to send message:",e),l.oR.error("Failed to send message",{description:"Please try again"})}}};return p?n?(0,r.jsx)(P.$Z,{editor:p,className:(0,m.A)("tiptap-editor",d)}):(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg",children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleBold().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("bold")?"bg-accent":""),children:(0,r.jsx)(U.A,{className:"h-4 w-4"})}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleItalic().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("italic")?"bg-accent":""),children:(0,r.jsx)(F.A,{className:"h-4 w-4"})}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleStrike().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("strike")?"bg-accent":""),children:(0,r.jsx)(O.A,{className:"h-4 w-4"})}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleCode().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("code")?"bg-accent":""),children:(0,r.jsx)(G.A,{className:"h-4 w-4"})}),(0,r.jsx)(er,{isActive:p.isActive("link"),onAddLink:e=>{p&&p.chain().focus().setLink({href:e}).run()}}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleBulletList().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("bulletList")?"bg-accent":""),children:(0,r.jsx)(J.A,{className:"h-4 w-4"})}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:()=>p.chain().focus().toggleOrderedList().run(),className:"h-8 w-8 p-0 ".concat(p.isActive("orderedList")?"bg-accent":""),children:(0,r.jsx)(H.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(P.$Z,{editor:p,className:"tiptap-editor min-h-[80px]"})}),(0,r.jsx)("div",{className:"flex items-center justify-end p-2 pt-0",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!x&&(0,r.jsx)("span",{className:"text-xs text-red-500 font-medium",children:"Disconnected"}),(0,r.jsx)(f,{onClick:b,disabled:!g||!x,size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground h-8 w-8 p-0 disabled:bg-muted disabled:text-muted-foreground",children:(0,r.jsx)(V.A,{className:"h-4 w-4"})})]})})]})}):n&&i?(0,r.jsx)("p",{className:"text-card-foreground text-sm whitespace-pre-wrap break-words",children:i}):null}var en=s(3387);function eo(e){let{className:t,...s}=e;return(0,r.jsx)(en.bL,{"data-slot":"avatar",className:g("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function ei(e){let{className:t,...s}=e;return(0,r.jsx)(en._V,{"data-slot":"avatar-image",className:g("aspect-square size-full object-cover",t),...s})}function el(e){let{className:t,...s}=e;return(0,r.jsx)(en.H4,{"data-slot":"avatar-fallback",className:g("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}function ec(){var e,t,s;let{usersTyping:a,users:n,currentUser:o}=(0,c.v)();if(0===a.length)return null;let i=a.filter(e=>e!==(null==o?void 0:o.socketId)).map(e=>n.find(t=>t.socketId===e)).filter(Boolean);if(0===i.length)return null;let l=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),d=(e,t)=>(0,r.jsxs)(eo,{className:"w-6 h-6 border-2 border-card",style:t>0?{marginLeft:-8}:{},children:[(0,r.jsx)(ei,{src:null==e?void 0:e.userIcon,alt:null==e?void 0:e.nickname}),(0,r.jsx)(el,{className:"bg-primary text-primary-foreground text-xs",children:l((null==e?void 0:e.nickname)||"?")})]},(null==e?void 0:e.socketId)||t);return(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-muted/50 rounded-lg border border-border mx-4 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[i.slice(0,3).map((e,t)=>d(e,t)),i.length>3&&(0,r.jsxs)("div",{className:"w-6 h-6 rounded-full bg-muted-foreground border-2 border-card flex items-center justify-center text-xs text-card font-medium",style:{marginLeft:-8},children:["+",i.length-3]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsx)("span",{className:"text-sm text-foreground",children:1===i.length?"".concat((null===(e=i[0])||void 0===e?void 0:e.nickname)||"Someone"," is typing..."):2===i.length?"".concat((null===(t=i[0])||void 0===t?void 0:t.nickname)||"Someone"," and ").concat((null===(s=i[1])||void 0===s?void 0:s.nickname)||"someone"," are typing..."):"".concat(i.length," people are typing...")})]})]})}function ed(){let{client:e,isConnected:t,reconnect:s}=(0,c.v)(),n=(0,a.useRef)(null),o=()=>{e&&t&&(e.sendMessage(z.mw.SET_TYPING_PRESENCE,{typing:!1}),n.current&&(clearTimeout(n.current),n.current=null))};return(0,r.jsxs)("div",{className:"px-4",children:[(0,r.jsx)(ec,{}),!t&&(0,r.jsxs)("div",{className:"bg-red-500/10 text-red-500 text-sm p-2 mb-2 rounded-md flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Connection lost. Messages cannot be sent."}),(0,r.jsx)(f,{variant:"ghost",size:"sm",onClick:s,className:"text-red-500 hover:text-red-600 hover:bg-red-500/20",children:"Reconnect"})]}),(0,r.jsx)(ea,{onTypingStart:()=>{e&&t&&(e.sendMessage(z.mw.SET_TYPING_PRESENCE,{typing:!0}),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{o()},3e3))},onTypingStop:o})]})}let eu=e=>{let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},em=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);function ex(){let{messages:e,currentUser:t,isReconnecting:s}=(0,c.v)(),n=(0,a.useRef)(null);(0,a.useEffect)(()=>{o()},[e]);let o=()=>{n.current&&setTimeout(()=>{var e;null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},10)},i=t=>{if(0===t)return!0;let s=e[t],r=e[t-1];return!!s.isSystemMessage||!!r.isSystemMessage||s.userNickname!==r.userNickname},l=s?e.filter(e=>!(e.isSystemMessage&&e.body.includes("joined")&&e.userNickname===(null==t?void 0:t.nickname))):e;return(0,r.jsx)("div",{className:"min-h-0 overflow-hidden",children:(0,r.jsx)(C,{className:"h-full bg-background",children:(0,r.jsxs)("div",{className:"flex flex-col p-4",children:[l.map((e,t)=>{let s=i(t);return(0,r.jsx)("div",{className:"flex ".concat(e.isSystemMessage?"justify-center":"justify-start"," ").concat(s?"pt-4":"pt-2"),children:e.isSystemMessage?e.userNickname?(0,r.jsxs)("div",{className:"flex gap-1 items-center bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:[(0,r.jsxs)(eo,{className:"w-6 h-6 flex-shrink-0",children:[(0,r.jsx)(ei,{src:e.userIcon,alt:e.userNickname}),(0,r.jsx)(el,{className:"bg-primary text-primary-foreground text-xs",children:em(e.userNickname)})]}),(0,r.jsx)("span",{className:"text-primary-foreground font-semibold",children:e.userNickname}),(0,r.jsx)("i",{className:"text-muted-foreground",children:e.body})]}):(0,r.jsx)("div",{className:"bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:e.body}):(0,r.jsxs)("div",{className:"flex items-start space-x-3 max-w-[80%]",children:[s?(0,r.jsxs)(eo,{className:"w-8 h-8 flex-shrink-0",children:[(0,r.jsx)(ei,{src:e.userIcon,alt:e.userNickname||"Guest"}),(0,r.jsx)(el,{className:"bg-primary text-primary-foreground text-xs",children:em(e.userNickname||"Guest")})]}):(0,r.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[i(t)&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("span",{className:"font-semibold text-sm text-foreground",children:e.userNickname||"Anonymous"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:eu(e.timestamp)})]}),(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg px-3 py-2 shadow-sm",children:(0,r.jsx)(ea,{content:JSON.parse(e.body),readonly:!0})})]})]})},t)}),(0,r.jsx)("div",{ref:n})]})})})}function eg(e){let{...t}=e;return(0,r.jsx)(Y.bL,{"data-slot":"sheet",...t})}function eh(e){let{...t}=e;return(0,r.jsx)(Y.l9,{"data-slot":"sheet-trigger",...t})}function ef(e){let{...t}=e;return(0,r.jsx)(Y.bm,{"data-slot":"sheet-close",...t})}function ep(e){let{...t}=e;return(0,r.jsx)(Y.ZL,{"data-slot":"sheet-portal",...t})}function eb(e){let{className:t,...s}=e;return(0,r.jsx)(Y.hJ,{"data-slot":"sheet-overlay",className:g("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function ev(e){let{className:t,children:s,side:a="right",...n}=e;return(0,r.jsxs)(ep,{children:[(0,r.jsx)(eb,{}),(0,r.jsxs)(Y.UC,{"data-slot":"sheet-content",className:g("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===a&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===a&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===a&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===a&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...n,children:[s,(0,r.jsxs)(Y.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,r.jsx)(Z.A,{className:"size-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function ej(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"sheet-header",className:g("flex flex-col gap-1.5 p-4",t),...s})}function eN(e){let{className:t,...s}=e;return(0,r.jsx)(Y.hE,{"data-slot":"sheet-title",className:g("text-foreground font-semibold",t),...s})}function ey(){let{chatRoomId:e,users:t,currentUser:s}=(0,c.v)(),r=async()=>{if(e)try{await navigator.clipboard.writeText(e),l.oR.success("Room ID copied to clipboard!",{description:"Room ID: ".concat(e),duration:3e3})}catch(e){l.oR.error("Failed to copy room ID",{description:"Please try again or copy manually"})}};return{chatRoomId:e,users:t,currentUser:s,copyRoomId:r,getUserInitials:e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}}let ew=(0,u.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ek(e){let{className:t,variant:s,asChild:a=!1,...n}=e,o=a?d.DX:"span";return(0,r.jsx)(o,{"data-slot":"badge",className:g(ew({variant:s}),t),...n})}function eC(e){let{user:t,index:s,currentUser:a,getUserInitials:n}=e,o=t.socketId===(null==a?void 0:a.socketId);return(0,r.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md transition-colors ".concat(o?"bg-accent/50 border border-border":"bg-muted hover:bg-muted"),children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(eo,{className:"w-8 h-8",children:[(0,r.jsx)(ei,{src:t.userIcon,alt:t.nickname}),(0,r.jsx)(el,{className:"bg-primary text-primary-foreground text-xs",children:n(t.nickname)})]}),(0,r.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-chart-2 border-2 border-card rounded-full"})]}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-foreground truncate",children:t.nickname}),o&&(0,r.jsx)(ek,{variant:"secondary",className:"text-mono text-xs bg-accent text-accent-foreground",children:"You"})]})})]},t.socketId||s)}var eI=s(3920);function eS(e){let{userCount:t,chatRoomId:s,onCopyRoomId:a,isConnected:n}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"h-5 w-5 text-primary"}),(0,r.jsxs)("h3",{className:"font-semibold text-foreground",children:["Users (",n?t:"...",")"]})]}),s&&(0,r.jsx)(f,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8 text-muted-foreground hover:text-foreground",disabled:!n,children:(0,r.jsx)(eI.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n?"Online":"Reconnecting..."}),s&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:["Room: ",s]})]})}function eR(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=ey(),{isConnected:o}=(0,c.v)();return(0,r.jsxs)(eg,{children:[(0,r.jsx)(eh,{asChild:!0,children:(0,r.jsx)(f,{variant:"outline",size:"sm",className:"lg:hidden border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(ev,{side:"right",className:"w-80 border-border p-2",children:[(0,r.jsx)(ej,{children:(0,r.jsx)(eN,{children:(0,r.jsxs)("div",{className:"flex flex-row items-center",children:[(0,r.jsx)("div",{children:(0,r.jsx)(eS,{userCount:t.length,chatRoomId:e,onCopyRoomId:a,isConnected:o})}),(0,r.jsx)(ef,{className:"!relative"})]})})}),(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eC,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:o?"No users in this room yet":"Reconnecting..."})]})]})]})}function eA(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=ey(),{isConnected:o}=(0,c.v)();return(0,r.jsxs)(p,{className:"bg-background border-border h-full !gap-0",children:[(0,r.jsx)(b,{className:"p-4 pt-0 border-b border-border",children:(0,r.jsx)(eS,{userCount:t.length,chatRoomId:e,onCopyRoomId:a,isConnected:o})}),(0,r.jsx)(j,{className:"p-2",children:(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eC,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:o?"No users in this room yet":"Reconnecting..."})]})})]})}function eE(){let{currentUser:e,setChatRoomId:t,setMessages:s,client:a,isConnected:o,disconnect:i}=(0,c.v)();return(0,r.jsx)("div",{className:"h-screen bg-background grid grid-rows-[1fr] overflow-hidden",children:(0,r.jsx)("div",{className:"container mx-auto max-w-7xl p-4 min-h-0",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 h-full",children:[(0,r.jsx)("div",{className:"lg:col-span-9 min-h-0",children:(0,r.jsxs)(p,{className:"bg-background border-border h-full grid grid-rows-[auto_1fr] gap-0 pb-4 pt-0 overflow-hidden",children:[(0,r.jsx)(b,{className:"bg-card p-6 border-b border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(v,{className:"flex items-center gap-2 text-card-foreground",children:[(0,r.jsx)(n.A,{className:"h-5 w-5 text-primary"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Chat Room"}),(0,r.jsx)("span",{className:"sm:hidden",children:"Chat"})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Welcome, ",null==e?void 0:e.nickname,"!"]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eR,{}),(0,r.jsx)(f,{variant:"outline",onClick:()=>{i(),s([])},size:"sm",className:"border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:"Leave"})]})]})}),(0,r.jsxs)(j,{className:"p-0 bg-background min-h-0 grid grid-rows-[1fr_auto]",children:[(0,r.jsx)(ex,{}),(0,r.jsx)(ed,{})]})]})}),(0,r.jsx)("div",{className:"hidden lg:block lg:col-span-3",children:(0,r.jsx)(eA,{})})]})})})}function eL(){let{chatRoomId:e}=(0,c.v)(),[t,s]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{s(!0)},[]),t&&e)?(0,r.jsx)(eE,{}):(0,r.jsx)(_,{})}},8249:(e,t,s)=>{"use strict";s.d(t,{ChatContextProvider:()=>v,v:()=>j});var r=s(5155),a=s(2115),n=s(9788),o=s(490),i=s(1824);class l extends i.cf{constructor(){super("ChatHistoryDatabase"),this.version(1).stores({messages:"++id, roomId, timestamp"})}}let c=new l,d=async(e,t)=>{e.isSystemMessage||await c.messages.add({...e,roomId:t})},u=async e=>await c.messages.where("roomId").equals(e).sortBy("timestamp"),m="Guest",x=(()=>{let e=sessionStorage.getItem("teleparty_tab_id");return e||(e=(0,o.Ak)(),sessionStorage.setItem("teleparty_tab_id",e)),e})(),g=e=>"teleparty_".concat(e,"_").concat(x),h=g("chat_room_id"),f=g("user_nickname"),p=g("user_icon"),b=(0,a.createContext)(void 0),v=e=>{let{children:t}=e,[s,o]=(0,a.useState)(null),[i,l]=(0,a.useState)(()=>localStorage.getItem(h)),[c,x]=(0,a.useState)(()=>({nickname:localStorage.getItem(f)||m,userIcon:localStorage.getItem(p)||void 0})),[g,v]=(0,a.useState)([]),[j,N]=(0,a.useState)(!1),[y,w]=(0,a.useState)(!!i),[k,C]=(0,a.useState)([]),[I,S]=(0,a.useState)([]),[R,A]=(0,a.useState)(!1),E=(0,a.useRef)(i);(0,a.useEffect)(()=>{E.current=i},[i]);let L=(0,a.useRef)(c);(0,a.useEffect)(()=>{L.current=c},[c]);let _=(0,a.useCallback)((e,t)=>{let s={isSystemMessage:!0,body:e,permId:"system",timestamp:Date.now(),...t&&{userNickname:t.nickname,userIcon:t.userIcon}};v(e=>[...e,s])},[]),z=(0,a.useCallback)(e=>{switch(e.type){case"userId":let t=e.data.userId;x(e=>e?{...e,socketId:t}:{nickname:m,socketId:t});break;case n.mw.SEND_MESSAGE:E.current&&d(e.data,E.current),v(t=>[...t,e.data]);break;case n.mw.SET_TYPING_PRESENCE:x(t=>(S(e.data.usersTyping.filter(e=>e!==(null==t?void 0:t.socketId))||[]),t));break;case"userList":C(e.data.map(e=>({nickname:e.userSettings.userNickname||m,userIcon:e.userSettings.userIcon,socketId:e.socketConnectionId})))}},[E]),T=(0,a.useCallback)(()=>{let e=new n.Ul({onConnectionReady:async()=>{var t;if(N(!0),E.current&&(null===(t=L.current)||void 0===t?void 0:t.nickname))try{await e.joinChatRoom(L.current.nickname,E.current,L.current.userIcon)}catch(e){console.error("Failed to rejoin chat room:",e),l(null),localStorage.removeItem(h)}w(!1)},onClose:()=>{N(!1),C([]),S([]),o(t=>t===e?null:t)},onMessage:z});o(e)},[z]),D=(0,a.useCallback)(()=>{s&&s.teardown(),i&&w(!0),o(null),A(!1)},[s,i]);return(0,a.useEffect)(()=>{if(!s&&!R){let e=setTimeout(T,1e3);return()=>clearTimeout(e)}},[s,R,T]),(0,a.useEffect)(()=>{let e=()=>{"visible"!==document.visibilityState||j||D()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[j,D]),(0,a.useEffect)(()=>{i?(localStorage.setItem(h,i),(async()=>{v(await u(i))})()):(localStorage.removeItem(h),v([]))},[i]),(0,a.useEffect)(()=>{(null==c?void 0:c.nickname)&&localStorage.setItem(f,c.nickname),(null==c?void 0:c.userIcon)?localStorage.setItem(p,c.userIcon):localStorage.removeItem(p)},[c]),(0,r.jsx)(b.Provider,{value:{client:s,isConnected:j,isReconnecting:y,chatRoomId:i,setChatRoomId:l,currentUser:c,setCurrentUser:x,users:k,usersTyping:I,messages:g,setMessages:v,addSystemMessage:_,reconnect:D,disconnect:()=>{A(!0),s&&(s.teardown(),o(null)),N(!1),C([]),S([]),l(null),localStorage.removeItem(h),_("Disconnected from chat service")}},children:t})},j=()=>{let e=(0,a.useContext)(b);if(void 0===e)throw Error("useChatContext must be used within a ChatContextProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4,277,949,992,441,517,358],()=>t(9589)),_N_E=e.O()}]);