(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9589:(e,t,s)=>{Promise.resolve().then(s.bind(s,3289))},3289:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eD});var r=s(5155),a=s(2115),n=s(9271),o=s(4505),i=s(2823),l=s(814),c=s(9788);let d="Guest",u=(0,a.createContext)(void 0),m=e=>{let{children:t}=e,[s,n]=(0,a.useState)(null),[o,i]=(0,a.useState)(null),[m,x]=(0,a.useState)({nickname:d}),[h,g]=(0,a.useState)([]),[f,p]=(0,a.useState)(!1),[b,v]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),y=(e,t)=>{let s={isSystemMessage:!0,body:e,permId:"system",timestamp:Date.now(),...t&&{userNickname:t.nickname,userIcon:t.userIcon}};g(e=>[...e,s])},w=e=>{switch(e.type){case"userId":let t=e.data.userId;x(e=>e?{...e,socketId:t}:{nickname:d,socketId:t});break;case c.mw.SEND_MESSAGE:let s=e.data;g(e=>[...e,s]);break;case c.mw.SET_TYPING_PRESENCE:N(e.data.usersTyping.filter(e=>e!==(null==m?void 0:m.socketId))||[]);break;case"userList":v(e.data.map(e=>({nickname:e.userSettings.userNickname||d,userIcon:e.userSettings.userIcon,socketId:e.socketConnectionId})))}},k=async()=>{n(new c.Ul({onConnectionReady:()=>{p(!0),l.oR.success("Connected to chat service",{description:"You can now create or join chat rooms"})},onClose:()=>{p(!1),v([]),N([]),l.oR.error("Connection lost",{description:"Please reload the page to reconnect",duration:5e3})},onMessage:w}))};return(0,a.useEffect)(()=>{o&&y("Welcome to the chat room! Room ID: ".concat(o))},[o]),(0,a.useEffect)(()=>{try{k()}catch(e){l.oR.error("Failed to connect to chat service",{description:"Please reload the page to try again"})}},[]),(0,r.jsx)(u.Provider,{value:{client:s,isConnected:f,chatRoomId:o,setChatRoomId:i,currentUser:m,setCurrentUser:x,users:b,usersTyping:j,messages:h,setMessages:g,addSystemMessage:y},children:t})},x=()=>{let e=(0,a.useContext)(u);if(!e)throw Error("useChatContext must be used within a ChatContextProvider");return e};var h=s(2317),g=s(1027),f=s(3463),p=s(9795);function b(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,p.QP)((0,f.$)(t))}let v=(0,g.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),j=a.forwardRef((e,t)=>{let{className:s,variant:a,size:n,asChild:o=!1,...i}=e,l=o?h.DX:"button";return(0,r.jsx)(l,{className:b(v({variant:a,size:n,className:s})),ref:t,...i})});function N(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:b("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function y(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:b("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function w(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:b("leading-none font-semibold",t),...s})}function k(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:b("px-6",t),...s})}function C(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:b("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}j.displayName="Button";var I=s(6195);function S(e){let{className:t,...s}=e;return(0,r.jsx)(I.b,{"data-slot":"label",className:b("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var A=s(2341);function R(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(A.bL,{"data-slot":"scroll-area",className:b("relative",t),...a,children:[(0,r.jsx)(A.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,r.jsx)(L,{}),(0,r.jsx)(A.OK,{})]})}function L(e){let{className:t,orientation:s="vertical",...a}=e;return(0,r.jsx)(A.VM,{"data-slot":"scroll-area-scrollbar",orientation:s,className:b("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",t),...a,children:(0,r.jsx)(A.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var E=s(6156);function z(e){let{className:t,...s}=e;return(0,r.jsx)(E.bL,{"data-slot":"tabs",className:b("flex flex-col gap-2",t),...s})}function T(e){let{className:t,...s}=e;return(0,r.jsx)(E.B8,{"data-slot":"tabs-list",className:b("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function _(e){let{className:t,...s}=e;return(0,r.jsx)(E.l9,{"data-slot":"tabs-trigger",className:b("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function D(e){let{className:t,...s}=e;return(0,r.jsx)(E.UC,{"data-slot":"tabs-content",className:b("flex-1 outline-none",t),...s})}function P(){let{client:e,isConnected:t,setChatRoomId:s,setCurrentUser:c}=x(),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(""),[g,f]=(0,a.useState)(""),[p,b]=(0,a.useState)(!1),[v,I]=(0,a.useState)(!1),A=async()=>{if(!e||!d.trim()){l.oR.error("Please enter a nickname",{description:"A nickname is required to create a chat room"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{b(!0);let t=await e.createChatRoom(d.trim(),m);c(e=>({...e,nickname:d.trim(),userIcon:m||void 0})),s(t),l.oR.success("Chat room created!",{description:"Room ID: ".concat(t),duration:5e3})}catch(e){console.error("Failed to create room:",e),l.oR.error("Failed to create chat room",{description:"Please try again"})}finally{b(!1)}},L=async()=>{if(!e||!d.trim()||!g.trim()){l.oR.error("Missing information",{description:"Please enter both nickname and room ID"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{I(!0),await e.joinChatRoom(d.trim(),g.trim(),m),c(e=>({...e,nickname:d.trim(),userIcon:m||void 0})),s(g.trim()),l.oR.success("Joined chat room!",{description:"Welcome to room: ".concat(g.trim()),duration:3e3})}catch(e){l.oR.error("Failed to join chat room",{description:"Please check the room ID and try again"})}finally{I(!1)}},E=t?{text:"Connected",color:"text-chart-2"}:{text:"Connecting...",color:"text-chart-1"};return(0,r.jsx)(R,{children:(0,r.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,r.jsxs)("div",{className:"container mx-auto max-w-md pt-20",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)(n.A,{className:"mx-auto h-16 w-16 text-primary mb-4"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Teleparty Chat"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Connect with friends in real-time"})]}),(0,r.jsxs)(N,{className:"bg-card border-border",children:[(0,r.jsx)(y,{children:(0,r.jsx)(w,{className:"text-center text-card-foreground",children:"Get Started"})}),(0,r.jsx)(k,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(S,{htmlFor:"nickname",className:"text-card-foreground",children:"Nickname"}),(0,r.jsx)(C,{id:"nickname",placeholder:"Enter your nickname",value:d,onChange:e=>u(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(S,{htmlFor:"userIcon",className:"text-card-foreground",children:"Profile Image URL (optional)"}),(0,r.jsx)(C,{id:"userIcon",placeholder:"https://example.com/avatar.jpg",value:m,onChange:e=>h(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 py-2",children:[(0,r.jsx)("div",{className:"flex-1 border-t border-border"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"next"}),(0,r.jsx)("div",{className:"flex-1 border-t border-border"})]}),(0,r.jsxs)(z,{defaultValue:"create",className:"w-full",children:[(0,r.jsxs)(T,{className:"grid w-full grid-cols-2 bg-muted",children:[(0,r.jsx)(_,{value:"create",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Create Room"}),(0,r.jsx)(_,{value:"join",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Join Room"})]}),(0,r.jsx)(D,{value:"create",className:"space-y-4",children:(0,r.jsx)(j,{onClick:A,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!d.trim()||p,children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"mr-2 h-4 w-4"}),"Create Chat Room"]})})}),(0,r.jsxs)(D,{value:"join",className:"space-y-4 pt-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(S,{htmlFor:"roomId",className:"text-card-foreground",children:"Room ID"}),(0,r.jsx)(C,{id:"roomId",placeholder:"Enter room ID",value:g,onChange:e=>f(e.target.value),className:"mt-1 bg-background border-border text-foreground placeholder:text-muted-foreground"})]}),(0,r.jsx)(j,{onClick:L,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!d.trim()||!g.trim()||v,children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Joining..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),"Join Chat Room"]})})]})]}),(0,r.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Status:"," ",(0,r.jsx)("span",{className:"font-medium ".concat(E.color),children:E.text})]})]})})]})]})})})}var M=s(53),F=s(8134),U=s(3512),G=s(7386),O=s(878),J=s(9201),H=s(9828),V=s(1024),Y=s(8701),B=s(9021),Z=s(8283),K=s(4113),W=s(4908),$=s(767);function q(e){let{...t}=e;return(0,r.jsx)(W.bL,{"data-slot":"dialog",...t})}function X(e){let{...t}=e;return(0,r.jsx)(W.l9,{"data-slot":"dialog-trigger",...t})}function Q(e){let{...t}=e;return(0,r.jsx)(W.ZL,{"data-slot":"dialog-portal",...t})}function ee(e){let{className:t,...s}=e;return(0,r.jsx)(W.hJ,{"data-slot":"dialog-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function et(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(Q,{"data-slot":"dialog-portal",children:[(0,r.jsx)(ee,{}),(0,r.jsxs)(W.UC,{"data-slot":"dialog-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[s,(0,r.jsxs)(W.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)($.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function es(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:b("flex flex-col gap-2 text-center sm:text-left",t),...s})}function er(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:b("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ea(e){let{className:t,...s}=e;return(0,r.jsx)(W.hE,{"data-slot":"dialog-title",className:b("text-lg leading-none font-semibold",t),...s})}function en(e){let{className:t,...s}=e;return(0,r.jsx)(W.VY,{"data-slot":"dialog-description",className:b("text-muted-foreground text-sm",t),...s})}function eo(e){let{onAddLink:t,isActive:s}=e,[n,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)("");return(0,r.jsxs)(q,{open:n,onOpenChange:o,children:[(0,r.jsx)(X,{asChild:!0,children:(0,r.jsx)(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 ".concat(s?"bg-accent":""),children:(0,r.jsx)(K.A,{className:"h-4 w-4"})})}),(0,r.jsx)(et,{className:"sm:max-w-md border-border",children:(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim())return;let s=i.trim();s.match(/^https?:\/\//)||(s="https://".concat(s)),t(s),l(""),o(!1)},children:[(0,r.jsxs)(es,{children:[(0,r.jsx)(ea,{children:"Add Link"}),(0,r.jsx)(en,{children:"Enter the URL you want to link to. HTTPS will be added automatically if not present."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(S,{htmlFor:"url",children:"URL"}),(0,r.jsx)(C,{id:"url",placeholder:"https://example.com",value:i,onChange:e=>l(e.target.value),autoFocus:!0})]})}),(0,r.jsxs)(er,{children:[(0,r.jsx)(j,{type:"button",variant:"outline",onClick:()=>{l(""),o(!1)},children:"Cancel"}),(0,r.jsx)(j,{type:"submit",disabled:!i.trim(),children:"Add Link"})]})]})})]})}function ei(e){let{onTypingStart:t,onTypingStop:s,readonly:a=!1,content:n,fallbackText:o,className:i}=e,{client:d}=x(),u=(0,U.hG)({extensions:[G.A.configure({code:{HTMLAttributes:{class:"text-green-500 bg-green-500/10 p-1 rounded-md"}},paragraph:{HTMLAttributes:{class:a?"text-card-foreground":"text-foreground"}},bulletList:{HTMLAttributes:{class:"list-disc pl-6 my-2"}},orderedList:{HTMLAttributes:{class:"list-decimal pl-6 my-2"}},listItem:{HTMLAttributes:{class:"my-1"}}}),M.Ay.configure({openOnClick:a,HTMLAttributes:{class:a?"text-primary underline hover:text-primary/80":"text-blue-500 underline",target:"_blank",rel:"noopener noreferrer"}}),...a?[]:[F.A.configure({placeholder:"Send a message",emptyEditorClass:"text-muted-foreground"})]],content:a?n:"",editable:!a,editorProps:{attributes:{class:a?"prose prose-sm max-w-none text-card-foreground rich-message-content ".concat(i||""):"prose prose-sm max-w-none focus:outline-none text-foreground placeholder:text-muted-foreground min-h-[40px] max-h-[120px] overflow-y-auto p-3"},handleKeyDown:a?void 0:(e,t)=>"Enter"===t.key&&!!t.shiftKey&&(t.preventDefault(),m(),!0)},onUpdate:a?void 0:e=>{let{editor:r}=e;r.getText().trim()?null==t||t():null==s||s()}}),m=()=>{if(d&&u&&!a&&u.getText().trim())try{let e=JSON.stringify(u.getJSON());d.sendMessage(c.mw.SEND_MESSAGE,{body:e}),u.commands.clearContent(),null==s||s()}catch(e){console.error("Failed to send message:",e),l.oR.error("Failed to send message",{description:"Please try again"})}};if(!u)return a&&o?(0,r.jsx)("p",{className:"text-card-foreground text-sm whitespace-pre-wrap break-words",children:o}):null;if(a)return(0,r.jsx)(U.$Z,{editor:u});let h=u.getText().trim().length>0;return(0,r.jsx)("div",{className:"px-4",children:(0,r.jsxs)("div",{className:"bg-card/80 border border-border rounded-lg shadow-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 p-2 pb-0",children:[(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleBold().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("bold")?"bg-accent":""),children:(0,r.jsx)(O.A,{className:"h-4 w-4"})}),(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleItalic().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("italic")?"bg-accent":""),children:(0,r.jsx)(J.A,{className:"h-4 w-4"})}),(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleStrike().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("strike")?"bg-accent":""),children:(0,r.jsx)(H.A,{className:"h-4 w-4"})}),(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleCode().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("code")?"bg-accent":""),children:(0,r.jsx)(V.A,{className:"h-4 w-4"})}),(0,r.jsx)(eo,{onAddLink:e=>{u&&u.chain().focus().setLink({href:e}).run()},isActive:u.isActive("link")}),(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleBulletList().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("bulletList")?"bg-accent":""),children:(0,r.jsx)(Y.A,{className:"h-4 w-4"})}),(0,r.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>u.chain().focus().toggleOrderedList().run(),className:"h-8 w-8 p-0 ".concat(u.isActive("orderedList")?"bg-accent":""),children:(0,r.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(U.$Z,{editor:u,className:"tiptap-editor min-h-[80px]"})}),(0,r.jsx)("div",{className:"flex items-center justify-end p-2 pt-0",children:(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(j,{onClick:m,disabled:!h,size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground h-8 w-8 p-0",children:(0,r.jsx)(Z.A,{className:"h-4 w-4"})})})})]})})}var el=s(3387);function ec(e){let{className:t,...s}=e;return(0,r.jsx)(el.bL,{"data-slot":"avatar",className:b("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function ed(e){let{className:t,...s}=e;return(0,r.jsx)(el._V,{"data-slot":"avatar-image",className:b("aspect-square size-full",t),...s})}function eu(e){let{className:t,...s}=e;return(0,r.jsx)(el.H4,{"data-slot":"avatar-fallback",className:b("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}function em(){var e,t,s;let{usersTyping:a,users:n,currentUser:o}=x();if(0===a.length)return null;let i=a.filter(e=>e!==(null==o?void 0:o.socketId)).map(e=>n.find(t=>t.socketId===e)).filter(Boolean);if(0===i.length)return null;let l=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),c=(e,t)=>(0,r.jsxs)(ec,{className:"w-6 h-6 border-2 border-card",style:t>0?{marginLeft:-8}:{},children:[(0,r.jsx)(ed,{src:null==e?void 0:e.userIcon,alt:null==e?void 0:e.nickname}),(0,r.jsx)(eu,{className:"bg-primary text-primary-foreground text-xs",children:l((null==e?void 0:e.nickname)||"?")})]},(null==e?void 0:e.socketId)||t);return(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-muted/50 rounded-lg border border-border mx-4 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[i.slice(0,3).map((e,t)=>c(e,t)),i.length>3&&(0,r.jsxs)("div",{className:"w-6 h-6 rounded-full bg-muted-foreground border-2 border-card flex items-center justify-center text-xs text-card font-medium",style:{marginLeft:-8},children:["+",i.length-3]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsx)("span",{className:"text-sm text-foreground",children:1===i.length?"".concat((null===(e=i[0])||void 0===e?void 0:e.nickname)||"Someone"," is typing..."):2===i.length?"".concat((null===(t=i[0])||void 0===t?void 0:t.nickname)||"Someone"," and ").concat((null===(s=i[1])||void 0===s?void 0:s.nickname)||"someone"," are typing..."):"".concat(i.length," people are typing...")})]})]})}function ex(){let{client:e}=x(),t=(0,a.useRef)(null),s=()=>{e&&(e.sendMessage(c.mw.SET_TYPING_PRESENCE,{typing:!1}),t.current&&(clearTimeout(t.current),t.current=null))};return(0,r.jsxs)("div",{children:[(0,r.jsx)(em,{}),(0,r.jsx)(ei,{onTypingStart:()=>{e&&(e.sendMessage(c.mw.SET_TYPING_PRESENCE,{typing:!0}),t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{s()},3e3))},onTypingStop:s})]})}let eh=e=>{let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},eg=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);function ef(){let{messages:e}=x(),t=(0,a.useRef)(null);(0,a.useEffect)(()=>{s()},[e]);let s=()=>{t.current&&setTimeout(()=>{var e;null===(e=t.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},10)},n=t=>{if(0===t)return!0;let s=e[t],r=e[t-1];return!!s.isSystemMessage||!!r.isSystemMessage||s.userNickname!==r.userNickname};return(0,r.jsx)("div",{className:"min-h-0 overflow-hidden",children:(0,r.jsx)(R,{className:"h-full bg-background",children:(0,r.jsxs)("div",{className:"flex flex-col p-4",children:[e.map((e,t)=>{let s=n(t);return(0,r.jsx)("div",{className:"flex ".concat(e.isSystemMessage?"justify-center":"justify-start"," ").concat(s?"pt-4":"pt-2"),children:e.isSystemMessage?e.userNickname?(0,r.jsxs)("div",{className:"flex gap-1 items-center bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:[(0,r.jsxs)(ec,{className:"w-6 h-6 flex-shrink-0",children:[(0,r.jsx)(ed,{src:e.userIcon,alt:e.userNickname}),(0,r.jsx)(eu,{className:"bg-primary text-primary-foreground text-xs",children:eg(e.userNickname)})]}),(0,r.jsx)("span",{className:"text-primary-foreground font-semibold",children:e.userNickname}),(0,r.jsx)("i",{className:"text-muted-foreground",children:e.body})]}):(0,r.jsx)("div",{className:"bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:e.body}):(0,r.jsxs)("div",{className:"flex items-start space-x-3 max-w-[80%]",children:[s?(0,r.jsxs)(ec,{className:"w-8 h-8 flex-shrink-0",children:[(0,r.jsx)(ed,{src:e.userIcon,alt:e.userNickname||"Guest"}),(0,r.jsx)(eu,{className:"bg-primary text-primary-foreground text-xs",children:eg(e.userNickname||"Guest")})]}):(0,r.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[n(t)&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("span",{className:"font-semibold text-sm text-foreground",children:e.userNickname||"Anonymous"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:eh(e.timestamp)})]}),(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg px-3 py-2 shadow-sm",children:(0,r.jsx)(ei,{content:JSON.parse(e.body),readonly:!0})})]})]})},t)}),(0,r.jsx)("div",{ref:t})]})})})}function ep(e){let{...t}=e;return(0,r.jsx)(W.bL,{"data-slot":"sheet",...t})}function eb(e){let{...t}=e;return(0,r.jsx)(W.l9,{"data-slot":"sheet-trigger",...t})}function ev(e){let{...t}=e;return(0,r.jsx)(W.bm,{"data-slot":"sheet-close",...t})}function ej(e){let{...t}=e;return(0,r.jsx)(W.ZL,{"data-slot":"sheet-portal",...t})}function eN(e){let{className:t,...s}=e;return(0,r.jsx)(W.hJ,{"data-slot":"sheet-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function ey(e){let{className:t,children:s,side:a="right",...n}=e;return(0,r.jsxs)(ej,{children:[(0,r.jsx)(eN,{}),(0,r.jsxs)(W.UC,{"data-slot":"sheet-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===a&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===a&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===a&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===a&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...n,children:[s,(0,r.jsxs)(W.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,r.jsx)($.A,{className:"size-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function ew(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"sheet-header",className:b("flex flex-col gap-1.5 p-4",t),...s})}function ek(e){let{className:t,...s}=e;return(0,r.jsx)(W.hE,{"data-slot":"sheet-title",className:b("text-foreground font-semibold",t),...s})}function eC(){let{chatRoomId:e,users:t,currentUser:s}=x(),r=async()=>{if(e)try{await navigator.clipboard.writeText(e),l.oR.success("Room ID copied to clipboard!",{description:"Room ID: ".concat(e),duration:3e3})}catch(e){l.oR.error("Failed to copy room ID",{description:"Please try again or copy manually"})}};return{chatRoomId:e,users:t,currentUser:s,copyRoomId:r,getUserInitials:e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}}let eI=(0,g.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function eS(e){let{className:t,variant:s,asChild:a=!1,...n}=e,o=a?h.DX:"span";return(0,r.jsx)(o,{"data-slot":"badge",className:b(eI({variant:s}),t),...n})}function eA(e){let{user:t,index:s,currentUser:a,getUserInitials:n}=e,o=t.socketId===(null==a?void 0:a.socketId);return(0,r.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md transition-colors ".concat(o?"bg-accent/50 border border-border":"bg-muted hover:bg-muted"),children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(ec,{className:"w-8 h-8",children:[(0,r.jsx)(ed,{src:t.userIcon,alt:t.nickname}),(0,r.jsx)(eu,{className:"bg-primary text-primary-foreground text-xs",children:n(t.nickname)})]}),(0,r.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-chart-2 border-2 border-card rounded-full"})]}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-foreground truncate",children:t.nickname}),o&&(0,r.jsx)(eS,{variant:"secondary",className:"text-mono text-xs bg-accent text-accent-foreground",children:"You"})]})})]},t.socketId||s)}var eR=s(3920);function eL(e){let{userCount:t,chatRoomId:s,onCopyRoomId:a,showRoomId:n=!0}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Users (",t,")"]}),(0,r.jsx)(eS,{variant:"secondary",className:"text-xs bg-secondary text-secondary-foreground",children:"Online"})]}),s&&(0,r.jsx)(j,{variant:"ghost",size:"icon",onClick:a,className:"text-muted-foreground hover:text-foreground",title:"Copy Room ID",children:(0,r.jsx)(eR.A,{className:"h-3 w-3"})})]}),s&&n&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground truncate text-left",children:["Room: ",s]})]})}function eE(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=eC();return(0,r.jsxs)(ep,{children:[(0,r.jsx)(eb,{asChild:!0,children:(0,r.jsx)(j,{variant:"outline",size:"sm",className:"lg:hidden border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(ey,{side:"right",className:"w-80 border-border p-2",children:[(0,r.jsx)(ew,{children:(0,r.jsx)(ek,{children:(0,r.jsxs)("div",{className:"flex flex-row items-center",children:[(0,r.jsx)("div",{children:(0,r.jsx)(eL,{userCount:t.length,chatRoomId:e,onCopyRoomId:a})}),(0,r.jsx)(ev,{className:"!relative"})]})})}),(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eA,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:"No users in this room yet"})]})]})]})}function ez(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=eC();return(0,r.jsxs)(N,{className:"h-full bg-card border-border",children:[(0,r.jsx)(y,{className:"pb-3",children:(0,r.jsx)(w,{className:"text-card-foreground",children:(0,r.jsx)(eL,{userCount:t.length,chatRoomId:e,onCopyRoomId:a})})}),(0,r.jsx)(k,{className:"pt-0",children:(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eA,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:"No users in this room yet"})]})})]})}function eT(){let{currentUser:e,setChatRoomId:t,setMessages:s,client:a}=x();return(0,r.jsx)("div",{className:"h-screen bg-background grid grid-rows-[1fr] overflow-hidden",children:(0,r.jsx)("div",{className:"container mx-auto max-w-7xl p-4 min-h-0",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 h-full",children:[(0,r.jsx)("div",{className:"lg:col-span-9 min-h-0",children:(0,r.jsxs)(N,{className:"bg-background border-border h-full grid grid-rows-[auto_1fr] gap-0 pb-4 pt-0 overflow-hidden",children:[(0,r.jsx)(y,{className:"bg-card p-6 border-b border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(w,{className:"flex items-center gap-2 text-card-foreground",children:[(0,r.jsx)(n.A,{className:"h-5 w-5 text-primary"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Chat Room"}),(0,r.jsx)("span",{className:"sm:hidden",children:"Chat"})]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Welcome, ",null==e?void 0:e.nickname,"!"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eE,{}),(0,r.jsx)(j,{variant:"outline",onClick:()=>{null==a||a.teardown(),t(null),s([])},size:"sm",className:"border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:"Leave"})]})]})}),(0,r.jsxs)(k,{className:"p-0 bg-background min-h-0 grid grid-rows-[1fr_auto]",children:[(0,r.jsx)(ef,{}),(0,r.jsx)(ex,{})]})]})}),(0,r.jsx)("div",{className:"hidden lg:block lg:col-span-3",children:(0,r.jsx)(ez,{})})]})})})}function e_(){let{chatRoomId:e}=x();return e?(0,r.jsx)(eT,{}):(0,r.jsx)(P,{})}function eD(){return(0,r.jsx)(m,{children:(0,r.jsx)(e_,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4,277,814,569,441,517,358],()=>t(9589)),_N_E=e.O()}]);