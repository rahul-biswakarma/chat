(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9589:(e,t,s)=>{Promise.resolve().then(s.bind(s,3289))},3289:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eG});var r=s(5155),a=s(2115),n=s(9271),o=s(4505),i=s(2823),l=s(814),c=s(9788),d=s(490);let u="Guest",m=(0,d.Ak)(),x=e=>"teleparty_".concat(e,"_").concat(m),g=x("chat_room_id"),h=x("user_nickname"),f=x("user_icon"),p=(0,a.createContext)(void 0),b=e=>{let{children:t}=e,[s,n]=(0,a.useState)(null),[o,i]=(0,a.useState)(()=>localStorage.getItem(g)),[l,d]=(0,a.useState)(()=>({nickname:localStorage.getItem(h)||u,userIcon:localStorage.getItem(f)||void 0})),[m,x]=(0,a.useState)([]),[b,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)([]),[y,w]=(0,a.useState)([]),[k,C]=(0,a.useState)(!1),[I,S]=(0,a.useState)(!1),R=(0,a.useCallback)((e,t)=>{let s={isSystemMessage:!0,body:e,permId:"system",timestamp:Date.now(),...t&&{userNickname:t.nickname,userIcon:t.userIcon}};x(e=>[...e,s])},[]),A=(0,a.useCallback)(e=>{switch(e.type){case"userId":let t=e.data.userId;d(e=>e?{...e,socketId:t}:{nickname:u,socketId:t});break;case c.mw.SEND_MESSAGE:let s=e.data;x(e=>[...e,s]);break;case c.mw.SET_TYPING_PRESENCE:let r=e.data.usersTyping;d(e=>(w(r.filter(t=>t!==(null==e?void 0:e.socketId))||[]),e));break;case"userList":N(e.data.map(e=>({nickname:e.userSettings.userNickname||u,userIcon:e.userSettings.userIcon,socketId:e.socketConnectionId})))}},[]),L=(0,a.useCallback)(()=>{let e=new c.Ul({onConnectionReady:async()=>{if(v(!0),o&&(null==l?void 0:l.nickname))try{await e.joinChatRoom(l.nickname,o,l.userIcon)}catch(e){i(null),localStorage.removeItem(g)}S(!1)},onClose:()=>{v(!1),N([]),w([]),n(t=>t===e?null:t)},onMessage:A});n(e)},[A,o,l,R]),E=(0,a.useCallback)(()=>{s&&s.teardown(),n(null),C(!1),S(!0)},[s]);return(0,a.useEffect)(()=>{if(!s&&!k){let e=setTimeout(()=>{L()},1e3);return()=>clearTimeout(e)}},[s,k,L]),(0,a.useEffect)(()=>{let e=()=>{"visible"!==document.visibilityState||b||E()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[b,E]),(0,a.useEffect)(()=>{o?(localStorage.setItem(g,o),R("Welcome to the chat room! Room ID: ".concat(o))):localStorage.removeItem(g)},[o,R]),(0,a.useEffect)(()=>{l&&(l.nickname&&localStorage.setItem(h,l.nickname),l.userIcon?localStorage.setItem(f,l.userIcon):localStorage.removeItem(f))},[l]),(0,r.jsx)(p.Provider,{value:{client:s,isConnected:b,isReconnecting:I,chatRoomId:o,setChatRoomId:i,currentUser:l,setCurrentUser:d,users:j,usersTyping:y,messages:m,setMessages:x,addSystemMessage:R,reconnect:E,disconnect:()=>{C(!0),s&&(s.teardown(),n(null)),v(!1),N([]),w([]),i(null),localStorage.removeItem(g),R("Disconnected from chat service")}},children:t})},v=()=>{let e=(0,a.useContext)(p);if(void 0===e)throw Error("useChatContext must be used within a ChatContextProvider");return e};var j=s(2317),N=s(1027),y=s(3463),w=s(9795);function k(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,w.QP)((0,y.$)(t))}let C=(0,N.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),I=a.forwardRef((e,t)=>{let{className:s,variant:a,size:n,asChild:o=!1,...i}=e,l=o?j.DX:"button";return(0,r.jsx)(l,{className:k(C({variant:a,size:n,className:s})),ref:t,...i})});function S(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:k("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function R(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:k("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function A(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:k("leading-none font-semibold",t),...s})}function L(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:k("px-6",t),...s})}function E(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:k("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}I.displayName="Button";var _=s(6195);function z(e){let{className:t,...s}=e;return(0,r.jsx)(_.b,{"data-slot":"label",className:k("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}var T=s(2341);function D(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(T.bL,{"data-slot":"scroll-area",className:k("relative",t),...a,children:[(0,r.jsx)(T.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,r.jsx)(P,{}),(0,r.jsx)(T.OK,{})]})}function P(e){let{className:t,orientation:s="vertical",...a}=e;return(0,r.jsx)(T.VM,{"data-slot":"scroll-area-scrollbar",orientation:s,className:k("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",t),...a,children:(0,r.jsx)(T.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var U=s(6156);function M(e){let{className:t,...s}=e;return(0,r.jsx)(U.bL,{"data-slot":"tabs",className:k("flex flex-col gap-2",t),...s})}function F(e){let{className:t,...s}=e;return(0,r.jsx)(U.B8,{"data-slot":"tabs-list",className:k("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function O(e){let{className:t,...s}=e;return(0,r.jsx)(U.l9,{"data-slot":"tabs-trigger",className:k("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function G(e){let{className:t,...s}=e;return(0,r.jsx)(U.UC,{"data-slot":"tabs-content",className:k("flex-1 outline-none",t),...s})}function J(){let{client:e,isConnected:t,setChatRoomId:s,setCurrentUser:c,reconnect:d}=v(),[u,m]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[p,b]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),y=async e=>{if(e.length<50)return e;try{let t=await fetch("/api/shorten-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!t.ok)throw Error("Failed to shorten URL");let s=await t.json();return l.oR.success("Avatar URL shortened successfully!"),s.shortUrl}catch(t){return l.oR.error("Failed to shorten avatar URL",{description:"The original URL will be used instead."}),e}},w=async()=>{if(!e||!u.trim()){l.oR.error("Please enter a nickname",{description:"A nickname is required to create a chat room"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{b(!0);let t=x?await y(x):"",r=await e.createChatRoom(u.trim(),t);c(e=>({...e,nickname:u.trim(),userIcon:t||void 0})),s(r),l.oR.success("Chat room created!",{description:"Room ID: ".concat(r),duration:5e3})}catch(e){console.error("Failed to create room:",e),l.oR.error("Failed to create chat room",{description:"Please try again"})}finally{b(!1)}},k=async()=>{if(!e||!u.trim()||!h.trim()){l.oR.error("Missing information",{description:"Please enter both nickname and room ID"});return}if(!t){l.oR.error("Connection not ready",{description:"Please wait for connection to be established"});return}try{N(!0);let t=x?await y(x):"";await e.joinChatRoom(u.trim(),h.trim(),t),c(e=>({...e,nickname:u.trim(),userIcon:t||void 0})),s(h.trim()),l.oR.success("Joined chat room!",{description:"Welcome to room: ".concat(h.trim()),duration:3e3})}catch(e){l.oR.error("Failed to join chat room",{description:"Please check the room ID and try again"})}finally{N(!1)}},C=t?{text:"Connected",color:"text-chart-2"}:{text:"Connecting...",color:"text-chart-1"};return(0,r.jsx)(D,{children:(0,r.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,r.jsxs)("div",{className:"container mx-auto max-w-md pt-20",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)(n.A,{className:"mx-auto h-16 w-16 text-primary mb-4"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Teleparty Chat"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Connect with friends in real-time"})]}),(0,r.jsxs)(S,{className:"bg-card border-border",children:[(0,r.jsx)(R,{children:(0,r.jsx)(A,{className:"text-center text-card-foreground",children:"Get Started"})}),(0,r.jsx)(L,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(z,{htmlFor:"nickname",className:"text-card-foreground",children:"Nickname"}),(0,r.jsx)(E,{id:"nickname",placeholder:"Enter your nickname",value:u,onChange:e=>m(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(z,{htmlFor:"userIcon",className:"text-card-foreground",children:"Profile Image URL (optional)"}),(0,r.jsx)(E,{id:"userIcon",placeholder:"https://example.com/avatar.jpg",value:x,onChange:e=>g(e.target.value),className:"bg-background border-border text-foreground placeholder:text-muted-foreground/40"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 py-2",children:[(0,r.jsx)("div",{className:"flex-1 border-t border-border"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"next"}),(0,r.jsx)("div",{className:"flex-1 border-t border-border"})]}),(0,r.jsxs)(M,{defaultValue:"create",className:"w-full",children:[(0,r.jsxs)(F,{className:"grid w-full grid-cols-2 bg-muted",children:[(0,r.jsx)(O,{value:"create",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Create Room"}),(0,r.jsx)(O,{value:"join",className:"data-[state=active]:bg-background data-[state=active]:text-foreground",children:"Join Room"})]}),(0,r.jsx)(G,{value:"create",className:"space-y-4",children:(0,r.jsx)(I,{onClick:w,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!u.trim()||p,children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"mr-2 h-4 w-4"}),"Create Chat Room"]})})}),(0,r.jsxs)(G,{value:"join",className:"space-y-4 pt-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(z,{htmlFor:"roomId",className:"text-card-foreground",children:"Room ID"}),(0,r.jsx)(E,{id:"roomId",placeholder:"Enter room ID",value:h,onChange:e=>f(e.target.value),className:"mt-1 bg-background border-border text-foreground placeholder:text-muted-foreground"})]}),(0,r.jsx)(I,{onClick:k,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground",disabled:!t||!u.trim()||!h.trim()||j,children:j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Joining..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),"Join Chat Room"]})})]})]}),(0,r.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Status:"," ",(0,r.jsx)("span",{className:"font-medium ".concat(C.color),children:C.text}),!t&&(0,r.jsx)(I,{variant:"link",size:"sm",onClick:d,className:"text-primary hover:text-primary/80 ml-2",children:"Reconnect"})]})]})})]})]})})})}var H=s(53),V=s(8134),B=s(3512),Y=s(7386),Z=s(878),W=s(9201),$=s(9828),q=s(1024),K=s(8701),X=s(9021),Q=s(8283),ee=s(4113),et=s(4908),es=s(767);function er(e){let{...t}=e;return(0,r.jsx)(et.bL,{"data-slot":"dialog",...t})}function ea(e){let{...t}=e;return(0,r.jsx)(et.l9,{"data-slot":"dialog-trigger",...t})}function en(e){let{...t}=e;return(0,r.jsx)(et.ZL,{"data-slot":"dialog-portal",...t})}function eo(e){let{className:t,...s}=e;return(0,r.jsx)(et.hJ,{"data-slot":"dialog-overlay",className:k("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function ei(e){let{className:t,children:s,...a}=e;return(0,r.jsxs)(en,{"data-slot":"dialog-portal",children:[(0,r.jsx)(eo,{}),(0,r.jsxs)(et.UC,{"data-slot":"dialog-content",className:k("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a,children:[s,(0,r.jsxs)(et.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(es.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function el(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:k("flex flex-col gap-2 text-center sm:text-left",t),...s})}function ec(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:k("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function ed(e){let{className:t,...s}=e;return(0,r.jsx)(et.hE,{"data-slot":"dialog-title",className:k("text-lg leading-none font-semibold",t),...s})}function eu(e){let{className:t,...s}=e;return(0,r.jsx)(et.VY,{"data-slot":"dialog-description",className:k("text-muted-foreground text-sm",t),...s})}function em(e){let{onAddLink:t,isActive:s}=e,[n,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)("");return(0,r.jsxs)(er,{open:n,onOpenChange:o,children:[(0,r.jsx)(ea,{asChild:!0,children:(0,r.jsx)(I,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 ".concat(s?"bg-accent":""),children:(0,r.jsx)(ee.A,{className:"h-4 w-4"})})}),(0,r.jsx)(ei,{className:"sm:max-w-md border-border",children:(0,r.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!i.trim())return;let s=i.trim();s.match(/^https?:\/\//)||(s="https://".concat(s)),t(s),l(""),o(!1)},children:[(0,r.jsxs)(el,{children:[(0,r.jsx)(ed,{children:"Add Link"}),(0,r.jsx)(eu,{children:"Enter the URL you want to link to. HTTPS will be added automatically if not present."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(z,{htmlFor:"url",children:"URL"}),(0,r.jsx)(E,{id:"url",placeholder:"https://example.com",value:i,onChange:e=>l(e.target.value),autoFocus:!0})]})}),(0,r.jsxs)(ec,{children:[(0,r.jsx)(I,{type:"button",variant:"outline",onClick:()=>{l(""),o(!1)},children:"Cancel"}),(0,r.jsx)(I,{type:"submit",disabled:!i.trim(),children:"Add Link"})]})]})})]})}function ex(e){let{onTypingStart:t,onTypingStop:s,readonly:n=!1,content:o,fallbackText:i,className:d}=e,{client:u,isConnected:m}=v(),[x,g]=a.useState(!1),h=(0,B.hG)({immediatelyRender:!1,extensions:[Y.A.configure({code:{HTMLAttributes:{class:"text-green-500 bg-green-500/10 p-1 rounded-md"}},paragraph:{HTMLAttributes:{class:n?"text-card-foreground":"text-foreground"}},bulletList:{HTMLAttributes:{class:"list-disc pl-6 my-2"}},orderedList:{HTMLAttributes:{class:"list-decimal pl-6 my-2"}},listItem:{HTMLAttributes:{class:"my-1"}}}),H.Ay.configure({openOnClick:n,HTMLAttributes:{class:n?"text-primary underline hover:text-primary/80":"text-blue-500 underline",target:"_blank",rel:"noopener noreferrer"}}),...n?[]:[V.A.configure({placeholder:"Send a message",emptyEditorClass:"text-muted-foreground"})]],content:n?o:"",editable:!n,editorProps:{attributes:{class:n?"prose prose-sm max-w-none text-card-foreground rich-message-content ".concat(d||""):"prose prose-sm max-w-none focus:outline-none text-foreground placeholder:text-muted-foreground min-h-[40px] max-h-[120px] overflow-y-auto p-3"},handleKeyDown:n?void 0:(e,t)=>"Enter"===t.key&&(t.preventDefault(),f(),!0)},onUpdate:n?void 0:e=>{let{editor:r}=e,a=r.getText().trim();g(!!a),a?null==t||t():null==s||s()}}),f=()=>{if(u&&h&&!n){if(!m){l.oR.error("Connection lost",{description:"Unable to send message. Please wait for reconnection."});return}if(h.getText().trim())try{let e=JSON.stringify(h.getJSON());u.sendMessage(c.mw.SEND_MESSAGE,{body:e}),h.commands.clearContent(),null==s||s()}catch(e){console.error("Failed to send message:",e),l.oR.error("Failed to send message",{description:"Please try again"})}}};return h?n?(0,r.jsx)(B.$Z,{editor:h,className:(0,y.A)("tiptap-editor",d)}):(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg",children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleBold().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("bold")?"bg-accent":""),children:(0,r.jsx)(Z.A,{className:"h-4 w-4"})}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleItalic().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("italic")?"bg-accent":""),children:(0,r.jsx)(W.A,{className:"h-4 w-4"})}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleStrike().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("strike")?"bg-accent":""),children:(0,r.jsx)($.A,{className:"h-4 w-4"})}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleCode().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("code")?"bg-accent":""),children:(0,r.jsx)(q.A,{className:"h-4 w-4"})}),(0,r.jsx)(em,{isActive:h.isActive("link"),onAddLink:e=>{h&&h.chain().focus().setLink({href:e}).run()}}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleBulletList().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("bulletList")?"bg-accent":""),children:(0,r.jsx)(K.A,{className:"h-4 w-4"})}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:()=>h.chain().focus().toggleOrderedList().run(),className:"h-8 w-8 p-0 ".concat(h.isActive("orderedList")?"bg-accent":""),children:(0,r.jsx)(X.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(B.$Z,{editor:h,className:"tiptap-editor min-h-[80px]"})}),(0,r.jsx)("div",{className:"flex items-center justify-end p-2 pt-0",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!m&&(0,r.jsx)("span",{className:"text-xs text-red-500 font-medium",children:"Disconnected"}),(0,r.jsx)(I,{onClick:f,disabled:!x||!m,size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground h-8 w-8 p-0 disabled:bg-muted disabled:text-muted-foreground",children:(0,r.jsx)(Q.A,{className:"h-4 w-4"})})]})})]})}):n&&i?(0,r.jsx)("p",{className:"text-card-foreground text-sm whitespace-pre-wrap break-words",children:i}):null}var eg=s(3387);function eh(e){let{className:t,...s}=e;return(0,r.jsx)(eg.bL,{"data-slot":"avatar",className:k("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...s})}function ef(e){let{className:t,...s}=e;return(0,r.jsx)(eg._V,{"data-slot":"avatar-image",className:k("aspect-square size-full object-cover",t),...s})}function ep(e){let{className:t,...s}=e;return(0,r.jsx)(eg.H4,{"data-slot":"avatar-fallback",className:k("bg-muted flex size-full items-center justify-center rounded-full",t),...s})}function eb(){var e,t,s;let{usersTyping:a,users:n,currentUser:o}=v();if(0===a.length)return null;let i=a.filter(e=>e!==(null==o?void 0:o.socketId)).map(e=>n.find(t=>t.socketId===e)).filter(Boolean);if(0===i.length)return null;let l=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),c=(e,t)=>(0,r.jsxs)(eh,{className:"w-6 h-6 border-2 border-card",style:t>0?{marginLeft:-8}:{},children:[(0,r.jsx)(ef,{src:null==e?void 0:e.userIcon,alt:null==e?void 0:e.nickname}),(0,r.jsx)(ep,{className:"bg-primary text-primary-foreground text-xs",children:l((null==e?void 0:e.nickname)||"?")})]},(null==e?void 0:e.socketId)||t);return(0,r.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-muted/50 rounded-lg border border-border mx-4 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[i.slice(0,3).map((e,t)=>c(e,t)),i.length>3&&(0,r.jsxs)("div",{className:"w-6 h-6 rounded-full bg-muted-foreground border-2 border-card flex items-center justify-center text-xs text-card font-medium",style:{marginLeft:-8},children:["+",i.length-3]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,r.jsx)("span",{className:"text-sm text-foreground",children:1===i.length?"".concat((null===(e=i[0])||void 0===e?void 0:e.nickname)||"Someone"," is typing..."):2===i.length?"".concat((null===(t=i[0])||void 0===t?void 0:t.nickname)||"Someone"," and ").concat((null===(s=i[1])||void 0===s?void 0:s.nickname)||"someone"," are typing..."):"".concat(i.length," people are typing...")})]})]})}function ev(){let{client:e,isConnected:t,reconnect:s}=v(),n=(0,a.useRef)(null),o=()=>{e&&t&&(e.sendMessage(c.mw.SET_TYPING_PRESENCE,{typing:!1}),n.current&&(clearTimeout(n.current),n.current=null))};return(0,r.jsxs)("div",{className:"px-4",children:[(0,r.jsx)(eb,{}),!t&&(0,r.jsxs)("div",{className:"bg-red-500/10 text-red-500 text-sm p-2 mb-2 rounded-md flex items-center justify-between",children:[(0,r.jsx)("span",{children:"Connection lost. Messages cannot be sent."}),(0,r.jsx)(I,{variant:"ghost",size:"sm",onClick:s,className:"text-red-500 hover:text-red-600 hover:bg-red-500/20",children:"Reconnect"})]}),(0,r.jsx)(ex,{onTypingStart:()=>{e&&t&&(e.sendMessage(c.mw.SET_TYPING_PRESENCE,{typing:!0}),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{o()},3e3))},onTypingStop:o})]})}let ej=e=>{let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},eN=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);function ey(){let{messages:e,currentUser:t,isReconnecting:s}=v(),n=(0,a.useRef)(null);(0,a.useEffect)(()=>{o()},[e]);let o=()=>{n.current&&setTimeout(()=>{var e;null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},10)},i=t=>{if(0===t)return!0;let s=e[t],r=e[t-1];return!!s.isSystemMessage||!!r.isSystemMessage||s.userNickname!==r.userNickname},l=s?e.filter(e=>!(e.isSystemMessage&&e.body.includes("joined")&&e.userNickname===(null==t?void 0:t.nickname))):e;return(0,r.jsx)("div",{className:"min-h-0 overflow-hidden",children:(0,r.jsx)(D,{className:"h-full bg-background",children:(0,r.jsxs)("div",{className:"flex flex-col p-4",children:[l.map((e,t)=>{let s=i(t);return(0,r.jsx)("div",{className:"flex ".concat(e.isSystemMessage?"justify-center":"justify-start"," ").concat(s?"pt-4":"pt-2"),children:e.isSystemMessage?e.userNickname?(0,r.jsxs)("div",{className:"flex gap-1 items-center bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:[(0,r.jsxs)(eh,{className:"w-6 h-6 flex-shrink-0",children:[(0,r.jsx)(ef,{src:e.userIcon,alt:e.userNickname}),(0,r.jsx)(ep,{className:"bg-primary text-primary-foreground text-xs",children:eN(e.userNickname)})]}),(0,r.jsx)("span",{className:"text-primary-foreground font-semibold",children:e.userNickname}),(0,r.jsx)("i",{className:"text-muted-foreground",children:e.body})]}):(0,r.jsx)("div",{className:"bg-accent text-accent-foreground px-3 py-1 rounded-full text-sm border border-border",children:e.body}):(0,r.jsxs)("div",{className:"flex items-start space-x-3 max-w-[80%]",children:[s?(0,r.jsxs)(eh,{className:"w-8 h-8 flex-shrink-0",children:[(0,r.jsx)(ef,{src:e.userIcon,alt:e.userNickname||"Guest"}),(0,r.jsx)(ep,{className:"bg-primary text-primary-foreground text-xs",children:eN(e.userNickname||"Guest")})]}):(0,r.jsx)("div",{className:"w-8 h-8 flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[i(t)&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("span",{className:"font-semibold text-sm text-foreground",children:e.userNickname||"Anonymous"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:ej(e.timestamp)})]}),(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg px-3 py-2 shadow-sm",children:(0,r.jsx)(ex,{content:JSON.parse(e.body),readonly:!0})})]})]})},t)}),(0,r.jsx)("div",{ref:n})]})})})}function ew(e){let{...t}=e;return(0,r.jsx)(et.bL,{"data-slot":"sheet",...t})}function ek(e){let{...t}=e;return(0,r.jsx)(et.l9,{"data-slot":"sheet-trigger",...t})}function eC(e){let{...t}=e;return(0,r.jsx)(et.bm,{"data-slot":"sheet-close",...t})}function eI(e){let{...t}=e;return(0,r.jsx)(et.ZL,{"data-slot":"sheet-portal",...t})}function eS(e){let{className:t,...s}=e;return(0,r.jsx)(et.hJ,{"data-slot":"sheet-overlay",className:k("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function eR(e){let{className:t,children:s,side:a="right",...n}=e;return(0,r.jsxs)(eI,{children:[(0,r.jsx)(eS,{}),(0,r.jsxs)(et.UC,{"data-slot":"sheet-content",className:k("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===a&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===a&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===a&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===a&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...n,children:[s,(0,r.jsxs)(et.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,r.jsx)(es.A,{className:"size-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function eA(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"sheet-header",className:k("flex flex-col gap-1.5 p-4",t),...s})}function eL(e){let{className:t,...s}=e;return(0,r.jsx)(et.hE,{"data-slot":"sheet-title",className:k("text-foreground font-semibold",t),...s})}function eE(){let{chatRoomId:e,users:t,currentUser:s}=v(),r=async()=>{if(e)try{await navigator.clipboard.writeText(e),l.oR.success("Room ID copied to clipboard!",{description:"Room ID: ".concat(e),duration:3e3})}catch(e){l.oR.error("Failed to copy room ID",{description:"Please try again or copy manually"})}};return{chatRoomId:e,users:t,currentUser:s,copyRoomId:r,getUserInitials:e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}}let e_=(0,N.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ez(e){let{className:t,variant:s,asChild:a=!1,...n}=e,o=a?j.DX:"span";return(0,r.jsx)(o,{"data-slot":"badge",className:k(e_({variant:s}),t),...n})}function eT(e){let{user:t,index:s,currentUser:a,getUserInitials:n}=e,o=t.socketId===(null==a?void 0:a.socketId);return(0,r.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md transition-colors ".concat(o?"bg-accent/50 border border-border":"bg-muted hover:bg-muted"),children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(eh,{className:"w-8 h-8",children:[(0,r.jsx)(ef,{src:t.userIcon,alt:t.nickname}),(0,r.jsx)(ep,{className:"bg-primary text-primary-foreground text-xs",children:n(t.nickname)})]}),(0,r.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-chart-2 border-2 border-card rounded-full"})]}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-foreground truncate",children:t.nickname}),o&&(0,r.jsx)(ez,{variant:"secondary",className:"text-mono text-xs bg-accent text-accent-foreground",children:"You"})]})})]},t.socketId||s)}var eD=s(3920);function eP(e){let{userCount:t,chatRoomId:s,onCopyRoomId:a,isConnected:n}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"h-5 w-5 text-primary"}),(0,r.jsxs)("h3",{className:"font-semibold text-foreground",children:["Users (",n?t:"...",")"]})]}),s&&(0,r.jsx)(I,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8 text-muted-foreground hover:text-foreground",disabled:!n,children:(0,r.jsx)(eD.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:n?"Online":"Reconnecting..."}),s&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:["Room: ",s]})]})}function eU(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=eE(),{isConnected:o}=v();return(0,r.jsxs)(ew,{children:[(0,r.jsx)(ek,{asChild:!0,children:(0,r.jsx)(I,{variant:"outline",size:"sm",className:"lg:hidden border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(eR,{side:"right",className:"w-80 border-border p-2",children:[(0,r.jsx)(eA,{children:(0,r.jsx)(eL,{children:(0,r.jsxs)("div",{className:"flex flex-row items-center",children:[(0,r.jsx)("div",{children:(0,r.jsx)(eP,{userCount:t.length,chatRoomId:e,onCopyRoomId:a,isConnected:o})}),(0,r.jsx)(eC,{className:"!relative"})]})})}),(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eT,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:o?"No users in this room yet":"Reconnecting..."})]})]})]})}function eM(){let{chatRoomId:e,users:t,currentUser:s,copyRoomId:a,getUserInitials:n}=eE(),{isConnected:o}=v();return(0,r.jsxs)(S,{className:"bg-background border-border h-full !gap-0",children:[(0,r.jsx)(R,{className:"p-4 pt-0 border-b border-border",children:(0,r.jsx)(eP,{userCount:t.length,chatRoomId:e,onCopyRoomId:a,isConnected:o})}),(0,r.jsx)(L,{className:"p-2",children:(0,r.jsxs)("div",{className:"space-y-2",children:[t.map((e,t)=>(0,r.jsx)(eT,{user:e,index:t,currentUser:s,getUserInitials:n},e.socketId||t)),0===t.length&&(0,r.jsx)("div",{className:"text-center text-muted-foreground text-sm py-4",children:o?"No users in this room yet":"Reconnecting..."})]})})]})}function eF(){let{currentUser:e,setChatRoomId:t,setMessages:s,client:a,isConnected:o,disconnect:i}=v();return(0,r.jsx)("div",{className:"h-screen bg-background grid grid-rows-[1fr] overflow-hidden",children:(0,r.jsx)("div",{className:"container mx-auto max-w-7xl p-4 min-h-0",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 h-full",children:[(0,r.jsx)("div",{className:"lg:col-span-9 min-h-0",children:(0,r.jsxs)(S,{className:"bg-background border-border h-full grid grid-rows-[auto_1fr] gap-0 pb-4 pt-0 overflow-hidden",children:[(0,r.jsx)(R,{className:"bg-card p-6 border-b border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(A,{className:"flex items-center gap-2 text-card-foreground",children:[(0,r.jsx)(n.A,{className:"h-5 w-5 text-primary"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Chat Room"}),(0,r.jsx)("span",{className:"sm:hidden",children:"Chat"})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Welcome, ",null==e?void 0:e.nickname,"!"]})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eU,{}),(0,r.jsx)(I,{variant:"outline",onClick:()=>{i(),s([])},size:"sm",className:"border-border text-foreground hover:bg-accent hover:text-accent-foreground",children:"Leave"})]})]})}),(0,r.jsxs)(L,{className:"p-0 bg-background min-h-0 grid grid-rows-[1fr_auto]",children:[(0,r.jsx)(ey,{}),(0,r.jsx)(ev,{})]})]})}),(0,r.jsx)("div",{className:"hidden lg:block lg:col-span-3",children:(0,r.jsx)(eM,{})})]})})})}function eO(){let{chatRoomId:e}=v();return e?(0,r.jsx)(eF,{}):(0,r.jsx)(J,{})}function eG(){return(0,r.jsx)(b,{children:(0,r.jsx)(eO,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4,277,814,944,441,517,358],()=>t(9589)),_N_E=e.O()}]);