(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4922:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9324,23)),Promise.resolve().then(s.bind(s,8249)),Promise.resolve().then(s.bind(s,4010)),Promise.resolve().then(s.bind(s,7113)),Promise.resolve().then(s.t.bind(s,5688,23)),Promise.resolve().then(s.t.bind(s,7051,23))},8249:(e,t,s)=>{"use strict";s.d(t,{ChatContextProvider:()=>p,v:()=>S});var r=s(5155),n=s(2115),a=s(9788),o=s(490),i=s(1824);class l extends i.cf{constructor(){super("ChatHistoryDatabase"),this.version(1).stores({messages:"++id, roomId, timestamp"})}}let c=new l,m=async(e,t)=>{await c.messages.add({...e,roomId:t})},u=async e=>await c.messages.where("roomId").equals(e).sortBy("timestamp"),d="Guest",h=(()=>{let e=localStorage.getItem("teleparty_tab_id");return e||(e=(0,o.Ak)(),localStorage.setItem("teleparty_tab_id",e)),e})(),y=e=>"teleparty_".concat(e,"_").concat(h),v=y("chat_room_id"),f=y("user_nickname"),b=y("user_icon"),g=(0,n.createContext)(void 0),p=e=>{let{children:t}=e,[s,o]=(0,n.useState)(null),[i,l]=(0,n.useState)(()=>sessionStorage.getItem(v)),[c,h]=(0,n.useState)(()=>({nickname:sessionStorage.getItem(f)||d,userIcon:sessionStorage.getItem(b)||void 0})),[y,p]=(0,n.useState)([]),[S,k]=(0,n.useState)(!1),[I,w]=(0,n.useState)(!!i),[C,_]=(0,n.useState)([]),[E,T]=(0,n.useState)([]),N=(0,n.useRef)(i);(0,n.useEffect)(()=>{N.current=i},[i]);let P=(0,n.useRef)(c);(0,n.useEffect)(()=>{P.current=c},[c]);let x=(0,n.useCallback)((e,t)=>{let s={isSystemMessage:!0,body:e,permId:"system",timestamp:Date.now(),...t&&{userNickname:t.nickname,userIcon:t.userIcon}};p(e=>[...e,s])},[]),M=(0,n.useCallback)(e=>{switch(e.type){case"userId":let t=e.data.userId;h(e=>e?{...e,socketId:t}:{nickname:d,socketId:t});break;case a.mw.SEND_MESSAGE:if(N.current){let t=e.data;m(t,N.current),p(e=>[...e,t])}break;case a.mw.SET_TYPING_PRESENCE:h(t=>(T(e.data.usersTyping.filter(e=>e!==(null==t?void 0:t.socketId))||[]),t));break;case"userList":_(e.data.map(e=>({nickname:e.userSettings.userNickname||d,userIcon:e.userSettings.userIcon,socketId:e.socketConnectionId})))}},[]),A=(0,n.useCallback)(()=>{let e=new a.Ul({onConnectionReady:async()=>{var t;if(k(!0),N.current&&(null===(t=P.current)||void 0===t?void 0:t.nickname))try{await e.joinChatRoom(P.current.nickname,N.current,P.current.userIcon);let t=await u(N.current),s=null==t?void 0:t.slice(-10).find(e=>{var t;return e.isSystemMessage&&"joined the party"===e.body&&e.userNickname===(null===(t=P.current)||void 0===t?void 0:t.nickname)});if(I||s)p(t||[]);else{let e={isSystemMessage:!0,body:"joined the party",permId:"system",timestamp:Date.now(),userNickname:P.current.nickname,userIcon:P.current.userIcon};N.current&&await m(e,N.current),p([...t||[],e])}}catch(e){console.error("Failed to rejoin chat room:",e),l(null),sessionStorage.removeItem(v)}w(!1)},onClose:async()=>{var t;if(N.current&&(null===(t=P.current)||void 0===t?void 0:t.nickname)){let e={isSystemMessage:!0,body:"left",permId:"system",timestamp:Date.now(),userNickname:P.current.nickname,userIcon:P.current.userIcon};await m(e,N.current),p(t=>[...t,e])}k(!1),_([]),T([]),o(t=>t===e?null:t)},onMessage:M});o(e)},[M]),L=(0,n.useCallback)(()=>{s&&s.teardown(),i&&w(!0),o(null)},[s,i]);return(0,n.useEffect)(()=>{s||A()},[s,A]),(0,n.useEffect)(()=>{i?sessionStorage.setItem(v,i):(sessionStorage.removeItem(v),p([]))},[i]),(0,n.useEffect)(()=>{(null==c?void 0:c.nickname)&&sessionStorage.setItem(f,c.nickname),(null==c?void 0:c.userIcon)?sessionStorage.setItem(b,c.userIcon):sessionStorage.removeItem(b)},[c]),(0,r.jsx)(g.Provider,{value:{client:s,isConnected:S,isReconnecting:I,chatRoomId:i,setChatRoomId:l,currentUser:c,setCurrentUser:h,users:C,usersTyping:E,messages:y,setMessages:p,addSystemMessage:x,reconnect:L,disconnect:()=>{s&&(s.teardown(),o(null)),k(!1),_([]),T([]),l(null),sessionStorage.removeItem(v),x("Disconnected from chat service")}},children:t})},S=()=>{let e=(0,n.useContext)(g);if(void 0===e)throw Error("useChatContext must be used within a ChatContextProvider");return e}},4010:(e,t,s)=>{"use strict";s.d(t,{Toaster:()=>o});var r=s(5155),n=s(7113),a=s(814);let o=e=>{let{...t}=e,{theme:s="system"}=(0,n.D)();return(0,r.jsx)(a.l$,{theme:s,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})}},9324:()=>{},5688:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_6ddc71",variable:"__variable_6ddc71"}},7051:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_b08e71",variable:"__variable_b08e71"}},7113:(e,t,s)=>{"use strict";s.d(t,{D:()=>m,ThemeProvider:()=>u});var r=s(2115),n=(e,t,s,r,n,a,o,i)=>{let l=document.documentElement,c=["light","dark"];function m(t){(Array.isArray(e)?e:[e]).forEach(e=>{let s="class"===e,r=s&&a?n.map(e=>a[e]||e):n;s?(l.classList.remove(...r),l.classList.add(a&&a[t]?a[t]:t)):l.setAttribute(e,t)}),i&&c.includes(t)&&(l.style.colorScheme=t)}if(r)m(r);else try{let e=localStorage.getItem(t)||s,r=o&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;m(r)}catch(e){}},a=["light","dark"],o="(prefers-color-scheme: dark)",i="undefined"==typeof window,l=r.createContext(void 0),c={setTheme:e=>{},themes:[]},m=()=>{var e;return null!=(e=r.useContext(l))?e:c},u=e=>r.useContext(l)?r.createElement(r.Fragment,null,e.children):r.createElement(h,{...e}),d=["light","dark"],h=e=>{let{forcedTheme:t,disableTransitionOnChange:s=!1,enableSystem:n=!0,enableColorScheme:i=!0,storageKey:c="theme",themes:m=d,defaultTheme:u=n?"system":"light",attribute:h="data-theme",value:g,children:p,nonce:S,scriptProps:k}=e,[I,w]=r.useState(()=>v(c,u)),[C,_]=r.useState(()=>"system"===I?b():I),E=g?Object.values(g):m,T=r.useCallback(e=>{let t=e;if(!t)return;"system"===e&&n&&(t=b());let r=g?g[t]:t,o=s?f(S):null,l=document.documentElement,c=e=>{"class"===e?(l.classList.remove(...E),r&&l.classList.add(r)):e.startsWith("data-")&&(r?l.setAttribute(e,r):l.removeAttribute(e))};if(Array.isArray(h)?h.forEach(c):c(h),i){let e=a.includes(u)?u:null,s=a.includes(t)?t:e;l.style.colorScheme=s}null==o||o()},[S]),N=r.useCallback(e=>{let t="function"==typeof e?e(I):e;w(t);try{localStorage.setItem(c,t)}catch(e){}},[I]),P=r.useCallback(e=>{_(b(e)),"system"===I&&n&&!t&&T("system")},[I,t]);r.useEffect(()=>{let e=window.matchMedia(o);return e.addListener(P),P(e),()=>e.removeListener(P)},[P]),r.useEffect(()=>{let e=e=>{e.key===c&&(e.newValue?w(e.newValue):N(u))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[N]),r.useEffect(()=>{T(null!=t?t:I)},[t,I]);let x=r.useMemo(()=>({theme:I,setTheme:N,forcedTheme:t,resolvedTheme:"system"===I?C:I,themes:n?[...m,"system"]:m,systemTheme:n?C:void 0}),[I,N,t,C,n,m]);return r.createElement(l.Provider,{value:x},r.createElement(y,{forcedTheme:t,storageKey:c,attribute:h,enableSystem:n,enableColorScheme:i,defaultTheme:u,value:g,themes:m,nonce:S,scriptProps:k}),p)},y=r.memo(e=>{let{forcedTheme:t,storageKey:s,attribute:a,enableSystem:o,enableColorScheme:i,defaultTheme:l,value:c,themes:m,nonce:u,scriptProps:d}=e,h=JSON.stringify([a,s,l,t,m,c,o,i]).slice(1,-1);return r.createElement("script",{...d,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:"(".concat(n.toString(),")(").concat(h,")")}})}),v=(e,t)=>{let s;if(!i){try{s=localStorage.getItem(e)||void 0}catch(e){}return s||t}},f=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},b=e=>(e||(e=window.matchMedia(o)),e.matches?"dark":"light")}},e=>{var t=t=>e(e.s=t);e.O(0,[261,949,441,517,358],()=>t(4922)),_N_E=e.O()}]);